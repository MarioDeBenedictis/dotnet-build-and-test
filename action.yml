name: 'Dotnet Build and Test'
description: 'Builds a .NET project, runs tests and handles EF Core migrations including rollback on failure'
author: Mario De Benedictis

# Add your action's branding here. This will appear on the GitHub Marketplace.
branding:
  icon: heart
  color: red

# Define your inputs here.
inputs:
  testFolder:
    description: 'Path to the test project folder'
    required: true
  migrationsFolder:
    description: 'Path to the migrations folder (default: testFolder)'
    required: false
  envName:
    description: 'Environment name for ASP.NET Core'
    required: false
    default: 'Test'
  skipMigrations:
    description: 'Skip applying migrations'
    required: false
    default: 'false'
  useGlobalDotnetEf:
    description: 'Use globally installed dotnet-ef instead of local'
    required: false
    default: 'false'
  recreateDatabase:
    description: 'Drop and recreate the database before running tests'
    required: false
    default: 'false'
  resetGitStrategy:
    description: 'Git reset strategy (soft, hard, mixed, or none)'
    required: false
    default: 'soft'
  seedDataScript:
    description: 'Path to seed data script if required'
    required: false
  testFormat:
    description: 'Format for test results (e.g., trx, html, json)'
    required: false
    default: 'html'
  parallelTests:
    description: 'Enable parallel test execution'
    required: false
    default: 'false'
  testTimeout:
    description: 'Test timeout in seconds'
    required: false
    default: '60'
  customDotnetArgs:
    description: 'Custom arguments for dotnet build'
    required: false

outputs:
  lastMigration:
    description: 'The last applied database migration'
  time:
    description: Your output description here

runs:
  using: node20
  main: dist/index.js

